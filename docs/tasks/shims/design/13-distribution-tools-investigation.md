# Distribution-Specific Tools Investigation Report

## Investigation Date
2025-07-08

## Purpose
To verify whether the current implementation of `discover_distribution_tools` in `/src/shim/discovery.rs` correctly handles distribution-specific tools, and to identify any additional distributions that may require special handling.

## Methodology

1. Installed multiple JDK distributions (version 21 for consistency)
2. Examined the contents of each distribution's `bin` directory
3. Compared tools against the standard JDK tools list in `/src/shim/tools.rs`
4. Identified distribution-specific tools

## Distributions Investigated

### Successfully Installed and Analyzed
- **Eclipse Temurin** 21.0.7
- **Amazon Corretto** 21.0.7.6.1
- **Azul Zulu** 21.42.19
- **Alibaba Dragonwell** 21.0.7.0.7.6
- **IBM Semeru** 21.0.7
- **GraalVM** 21.0.7 (re-attempted successfully on 2025-07-09)

### Installation Attempted but Failed
- **BellSoft Liberica** 21, 21.0.7+9, 21+37 (version format mismatch - kopi adds ".0.0" to version)
- **SAP Machine** 21 (not available in kopi metadata)

## Findings

### 1. GraalVM Special Handling Needs Update

The current implementation in `discover_distribution_tools` checks for:
- `gu` (GraalVM Updater)
- `native-image` (Native Image compiler)

However, investigation of GraalVM 21.0.7 revealed:
- `native-image` is present âœ“
- `gu` is NOT present in GraalVM 21.0.7 (likely removed in recent versions)
- `js` is NOT present in GraalVM 21.0.7 (consistent with tools.rs which notes it was removed in version 23+)

Additionally, GraalVM 21.0.7 includes these tools not currently in the registry:
- `native-image-configure` - Configuration tool for native image builds
- `native-image-inspect` - Inspection tool for native images

These additional native-image related tools should be considered for inclusion.

### 2. Missing Standard JDK Tools in Registry

The following tools were found in ALL investigated distributions but are NOT listed in `/src/shim/tools.rs`:

```
jdeprscan    - Deprecated API scanner
jhsdb        - HotSpot Debugger
jimage       - JDK module image tool
jrunscript   - Script execution tool
jstatd       - JSTAT daemon
jwebserver   - Simple web server (Java 18+)
rmiregistry  - RMI registry
```

These appear to be standard JDK tools that should be added to the tool registry.

### 3. IBM Semeru Contains OpenJ9-Specific Tools

**IBM Semeru** includes four distribution-specific tools not found in HotSpot-based JDKs:
- **jdmpview** - Java dump viewer for analyzing system dumps
- **jitserver** - JIT compilation server for offloading JIT compilation
- **jpackcore** - Tool for packaging core dumps
- **traceformat** - Tool for formatting trace files

These tools are specific to the OpenJ9 VM that Semeru uses.

### 4. GraalVM Contains Additional Native Image Tools

**GraalVM 21.0.7** investigation revealed:
- Standard JDK tools plus three native-image related tools:
  - **native-image** - Already tracked in tools.rs
  - **native-image-configure** - NOT in tools.rs, helps configure native image builds
  - **native-image-inspect** - NOT in tools.rs, inspects native image binaries
- Missing tools that are defined in tools.rs:
  - **gu** - GraalVM Updater (not present in 21.0.7)
  - **js** - JavaScript interpreter (consistent with removal in 23+)

### 5. Other Distributions

- **Alibaba Dragonwell**: No distribution-specific tools found (contains only standard JDK tools)
- **Temurin, Corretto, Zulu**: No vendor-specific tools discovered beyond the standard JDK toolset

## Recommendations

1. **Update GraalVM Special Handling**: 
   - Remove `gu` from the GraalVM tool check (no longer present in recent versions)
   - Keep `native-image` as the primary GraalVM identifier
   - Consider adding `native-image-configure` and `native-image-inspect` to the tool registry

2. **Add IBM Semeru/OpenJ9 Special Handling**: Update `discover_distribution_tools` to recognize Semeru's four specific tools:
   - jdmpview
   - jitserver
   - jpackcore
   - traceformat

3. **Update Standard Tools Registry**: Add the seven missing standard tools to `/src/shim/tools.rs`:
   - Consider version constraints (e.g., `jwebserver` requires Java 18+)
   - These tools should be categorized appropriately (Debug, Utility, etc.)

4. **Future Distribution Investigations**: 
   - Red Hat Mandrel (GraalVM derivative, may have unique tools)
   - OpenJDK
   - Trava OpenJDK
   - Tencent Kona
   - BellSoft Liberica (once version format issues are resolved)

5. **Consider Tool Discovery Enhancement**: The current approach of hardcoding distribution-specific tools works for known cases but could be enhanced with:
   - Dynamic discovery of non-standard tools
   - Metadata about tool availability per distribution version
   - Caching of discovered tools per installation

## Technical Notes

- The investigation used the command pattern: `cargo run --bin kopi -- install <distribution>@21`
- Tool lists were generated by comparing directory listings against the standard tools extracted from `tools.rs`
- GraalVM 21.0.7 was successfully installed after initial failures (2025-07-09)
- The absence of `gu` in GraalVM 21.0.7 suggests Oracle has changed the GraalVM distribution model

## Conclusion

The investigation revealed that two distributions require special handling in `discover_distribution_tools`:

1. **GraalVM** - Current implementation needs updating:
   - Remove check for `gu` (no longer present in GraalVM 21.0.7)
   - Continue checking for `native-image` as the primary identifier
   - Consider adding `native-image-configure` and `native-image-inspect` to the registry
   
2. **IBM Semeru** - Newly discovered to include four OpenJ9-specific tools that need to be added

The implementation should be updated to reflect these findings. Additionally, seven standard JDK tools were found to be missing from the tool registry and should be added.