# Distribution-Specific Tools Investigation Report

## Investigation Date
2025-07-08

## Purpose
To verify whether the current implementation of `discover_distribution_tools` in `/src/shim/discovery.rs` correctly handles distribution-specific tools, and to identify any additional distributions that may require special handling.

## Methodology

1. Installed multiple JDK distributions (version 21 for consistency)
2. Examined the contents of each distribution's `bin` directory
3. Compared tools against the standard JDK tools list in `/src/shim/tools.rs`
4. Identified distribution-specific tools

## Distributions Investigated

### Successfully Installed and Analyzed
- **Eclipse Temurin** 21.0.7
- **Amazon Corretto** 21.0.7.6.1
- **Azul Zulu** 21.42.19

### Installation Attempted but Failed
- **GraalVM** 21 (archive extraction error)
- **BellSoft Liberica** 21 (version format mismatch)
- **SAP Machine** 21 (not available in metadata)

## Findings

### 1. GraalVM Special Handling is Justified

The current implementation in `discover_distribution_tools` specifically handles GraalVM by checking for:
- `gu` (GraalVM Updater)
- `native-image` (Native Image compiler)

This special handling is appropriate because these tools are unique to GraalVM and not present in other distributions.

### 2. Missing Standard JDK Tools in Registry

The following tools were found in ALL investigated distributions but are NOT listed in `/src/shim/tools.rs`:

```
jdeprscan    - Deprecated API scanner
jhsdb        - HotSpot Debugger
jimage       - JDK module image tool
jrunscript   - Script execution tool
jstatd       - JSTAT daemon
jwebserver   - Simple web server (Java 18+)
rmiregistry  - RMI registry
```

These appear to be standard JDK tools that should be added to the tool registry.

### 3. No Additional Distribution-Specific Tools Found

In the distributions successfully analyzed (Temurin, Corretto, Zulu), no vendor-specific tools were discovered beyond the standard JDK toolset. All three distributions contained identical tool sets.

## Recommendations

1. **Maintain GraalVM Special Handling**: The current implementation correctly identifies GraalVM-specific tools.

2. **Update Standard Tools Registry**: Add the seven missing standard tools to `/src/shim/tools.rs`:
   - Consider version constraints (e.g., `jwebserver` requires Java 18+)
   - These tools should be categorized appropriately (Debug, Utility, etc.)

3. **Future Distribution Investigations**: 
   - IBM Semeru (may include `semeru-version` as noted in comments)
   - Red Hat Mandrel (GraalVM derivative, may have unique tools)
   - Alibaba Dragonwell
   - BellSoft Liberica (once version format issues are resolved)

4. **Consider Tool Discovery Enhancement**: The current approach of hardcoding distribution-specific tools works for known cases but could be enhanced with:
   - Dynamic discovery of non-standard tools
   - Metadata about tool availability per distribution version
   - Caching of discovered tools per installation

## Technical Notes

- The investigation used the command pattern: `cargo run --bin kopi -- install <distribution>@21`
- Tool lists were generated by comparing directory listings against the standard tools extracted from `tools.rs`
- The GraalVM installation failure appears to be related to nested archive handling

## Conclusion

The current implementation of `discover_distribution_tools` is correct for its intended purpose. GraalVM is appropriately special-cased due to its unique tools. No other distributions in the tested set require special handling at this time.