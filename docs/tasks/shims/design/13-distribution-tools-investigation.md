# Distribution-Specific Tools Investigation Report

## Investigation Date
2025-07-08

## Purpose
To verify whether the current implementation of `discover_distribution_tools` in `/src/shim/discovery.rs` correctly handles distribution-specific tools, and to identify any additional distributions that may require special handling.

## Methodology

1. Installed multiple JDK distributions (version 21 for consistency)
2. Examined the contents of each distribution's `bin` directory
3. Compared tools against the standard JDK tools list in `/src/shim/tools.rs`
4. Identified distribution-specific tools

## Distributions Investigated

### Successfully Installed and Analyzed
- **Eclipse Temurin** 21.0.7
- **Amazon Corretto** 21.0.7.6.1
- **Azul Zulu** 21.42.19
- **Alibaba Dragonwell** 21.0.7.0.7.6
- **IBM Semeru** 21.0.7

### Installation Attempted but Failed
- **GraalVM** 21, 22 (nested archive extraction error with `license-information-user-manual.zip`)
- **BellSoft Liberica** 21, 21.0.7+9, 21+37 (version format mismatch - kopi adds ".0.0" to version)
- **SAP Machine** 21 (not available in kopi metadata)

## Findings

### 1. GraalVM Special Handling is Justified

The current implementation in `discover_distribution_tools` specifically handles GraalVM by checking for:
- `gu` (GraalVM Updater)
- `native-image` (Native Image compiler)

This special handling is appropriate because these tools are unique to GraalVM and not present in other distributions.

### 2. Missing Standard JDK Tools in Registry

The following tools were found in ALL investigated distributions but are NOT listed in `/src/shim/tools.rs`:

```
jdeprscan    - Deprecated API scanner
jhsdb        - HotSpot Debugger
jimage       - JDK module image tool
jrunscript   - Script execution tool
jstatd       - JSTAT daemon
jwebserver   - Simple web server (Java 18+)
rmiregistry  - RMI registry
```

These appear to be standard JDK tools that should be added to the tool registry.

### 3. IBM Semeru Contains OpenJ9-Specific Tools

**IBM Semeru** includes four distribution-specific tools not found in HotSpot-based JDKs:
- **jdmpview** - Java dump viewer for analyzing system dumps
- **jitserver** - JIT compilation server for offloading JIT compilation
- **jpackcore** - Tool for packaging core dumps
- **traceformat** - Tool for formatting trace files

These tools are specific to the OpenJ9 VM that Semeru uses.

### 4. Other Distributions

- **Alibaba Dragonwell**: No distribution-specific tools found (contains only standard JDK tools)
- **Temurin, Corretto, Zulu**: No vendor-specific tools discovered beyond the standard JDK toolset

## Recommendations

1. **Maintain GraalVM Special Handling**: The current implementation correctly identifies GraalVM-specific tools.

2. **Add IBM Semeru/OpenJ9 Special Handling**: Update `discover_distribution_tools` to recognize Semeru's four specific tools:
   - jdmpview
   - jitserver
   - jpackcore
   - traceformat

3. **Update Standard Tools Registry**: Add the seven missing standard tools to `/src/shim/tools.rs`:
   - Consider version constraints (e.g., `jwebserver` requires Java 18+)
   - These tools should be categorized appropriately (Debug, Utility, etc.)

4. **Future Distribution Investigations**: 
   - Red Hat Mandrel (GraalVM derivative, may have unique tools)
   - OpenJDK
   - Trava OpenJDK
   - Tencent Kona
   - BellSoft Liberica (once version format issues are resolved)

5. **Consider Tool Discovery Enhancement**: The current approach of hardcoding distribution-specific tools works for known cases but could be enhanced with:
   - Dynamic discovery of non-standard tools
   - Metadata about tool availability per distribution version
   - Caching of discovered tools per installation

## Technical Notes

- The investigation used the command pattern: `cargo run --bin kopi -- install <distribution>@21`
- Tool lists were generated by comparing directory listings against the standard tools extracted from `tools.rs`
- The GraalVM installation failure appears to be related to nested archive handling

## Conclusion

The investigation revealed that two distributions require special handling in `discover_distribution_tools`:

1. **GraalVM** - Already correctly implemented with `gu` and `native-image`
2. **IBM Semeru** - Newly discovered to include four OpenJ9-specific tools that need to be added

The implementation has been updated to handle both distributions. Additionally, seven standard JDK tools were found to be missing from the tool registry and have been added.